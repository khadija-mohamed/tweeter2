//documemnt ready, where all the functions will be called and worked on within
$(document).ready(function() {

  //testing submission and using ajax to Post tweets
  $('.tweet-form').submit(function(event) {
    console.log("Testing submission.");
    //prevent default action from occuring
    event.preventDefault();

    let submission = $('tweet-form').serialize();
    $.ajax({
      url: '/tweets',
      method: 'POST',
      data: submission,
    })
    .then((res) => {
      $('.tweet-form').children('textarea').val('');
      $('.counter').val(140)
      loadTweets();
    });
  })

// createTweetElement function to generate tweets to go into main container, also dated with timeago
const createTweetElement = function (tweet) {
  let time = timeago.format(tweet.created_at);
  let $tweet = 
  $(
    `<article>
      <header>
        <div class="icon"><img src="/images/profile-hex.png"> </div>
        <div class="name">Rosey</div>
        <div class="username">@username</div>
      </header>
      <main class='tweet-content'>
        <span>I have seen further by standing on the shoulder of giants</span>
      </main>
      <footer>
        <div class="time">${time}</div>
        <div class="buttons">
          <span><i class="fa fa-flag" aria-hidden="true"></i></span>
          <span><i class="fa fa-retweet" aria-hidden="true"></i></span>
          <span><i class="fa fa-heart" aria-hidden="true"></i></span>
        </div>
    </section>
    </article>`)
    
  return $tweet;
};

//rendering tweets that are being generated by createTweet function and looping through them
const renderTweets = function (tweets) {
  for (let tweet of tweets) {
    const value = createTweetElement(tweet);
    $('.tweets').prepend(value);
  }
};

//loading tweets with Ajax,
const loadTweets = function() {
  $.ajax({
    url: '/tweets',
    method: 'GET',
    data: data,
  })
    .then(function(data) {
      renderTweets(data);
  });
};

  postTweets();
  loadTweets();

});